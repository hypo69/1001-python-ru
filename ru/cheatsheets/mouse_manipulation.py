# mouse_manipulation.py
# Учебный код для демонстрации работы с библиотекой 'mouse' в Python.
# ----------------------------------------------------------------------
# Шаг 1: Установка библиотеки 'mouse' (выполнить в терминале):
# pip install mouse
# ----------------------------------------------------------------------

import mouse
import math
import time 

# ======================================================================
# Шаг 9: Вспомогательные функции для рисования (используются в конце)
# ======================================================================

def draw_square(size):
    """Рисует квадрат, используя относительное перемещение."""
    print(f"Рисуем квадрат размером {size}...")
    # Начинаем с текущей позиции курсора
    mouse.press()  # Нажимаем левую кнопку
    
    # Рисуем 4 стороны (относительное перемещение)
    mouse.move(size, 0, absolute=False, duration=0.2)
    mouse.move(0, size, absolute=False, duration=0.2)
    mouse.move(-size, 0, absolute=False, duration=0.2)
    mouse.move(0, -size, absolute=False, duration=0.2)
    
    mouse.release() # Отпускаем кнопку
    print("Квадрат нарисован.")

def draw_circle(radius):
    """
    Рисует круг. Использует абсолютное позиционирование 
    для обеспечения правильной формы.
    """
    print(f"Рисуем круг радиусом {radius}...")
    
    # Получаем текущую позицию курсора, которая будет центром круга
    center_x, center_y = mouse.get_position() 
    
    mouse.press()
    for i in range(0, 360, 5):
        angle = math.radians(i)
        
        # Рассчитываем абсолютные координаты точки на окружности
        x = center_x + radius * math.cos(angle)
        y = center_y + radius * math.sin(angle)
        
        # Перемещаем курсор в абсолютную позицию на окружности
        mouse.move(x, y, absolute=True, duration=0.01)
        
    mouse.release()
    print("Круг нарисован.")


# ======================================================================
# Основная часть программы (Выполнение учебных шагов)
# ======================================================================

if __name__ == "__main__":
    
    print("--- Запуск учебного кода 'mouse_manipulation.py' ---")
    
    # --- Шаг 2: Симулирование щелчков и проверка нажатия ---
    print("\n--- Шаг 2: Щелчки и проверка нажатия ---")
    
    # ВНИМАНИЕ: Раскомментируйте, чтобы выполнить реальный клик
    # mouse.click('left') 
    # mouse.click('right')
    
    # Проверка нажатия кнопки
    print("Пожалуйста, нажмите и удерживайте правую кнопку мыши (3 сек)...")
    time.sleep(3)
    is_pressed = mouse.is_pressed("right")
    print(f"Правая кнопка нажата: {is_pressed}")
    time.sleep(1)


    # --- Шаг 3: Получение позиции курсора ---
    print("\n--- Шаг 3: Получение позиции курсора ---")
    position = mouse.get_position()
    print(f"Текущая позиция курсора: {position}")
    time.sleep(1)
    
    
    # --- Шаг 4: Перетаскивание и Шаг 5: Перемещение ---
    print("\n--- Шаг 4 & 5: Перемещение и Перетаскивание ---")
    print("ВНИМАНИЕ: Курсор мыши сейчас будет перемещаться!")
    
    # Шаг 5: Перемещение в абсолютную позицию (200, 300)
    mouse.move(200, 300, absolute=True, duration=0.2)
    print("Курсор перемещен в (200, 300).")
    time.sleep(1)
    
    # Шаг 4: Абсолютное перетаскивание из (200, 300) в (300, 400)
    mouse.drag(200, 300, 300, 400, absolute=True, duration=0.5) 
    print("Выполнено абсолютное перетаскивание из (200, 300) в (300, 400).")
    time.sleep(2)


    # --- Шаг 6: Обработка событий мыши ---
    print("\n--- Шаг 6: Обработка событий мыши ---")
    def left_click_handler():
        print(">> [ОБРАБОТЧИК] Нажата левая кнопка мыши")
    
    mouse.on_click(left_click_handler)
    print("Обработчик левого щелчка активен на 5 секунд. Попробуйте кликнуть левой кнопкой.")
    time.sleep(5) 
    mouse.unhook_all()
    print("Обработчики удалены.")
    time.sleep(1)


    # --- Шаг 7: Прокрутка колеса мыши ---
    print("\n--- Шаг 7: Прокрутка колеса мыши ---")
    # Прокрутка вниз на 2 шага (если есть окно с полосой прокрутки)
    mouse.wheel(-2)
    print("Выполнена прокрутка колеса вниз.")
    time.sleep(1)
    
    
    # --- Шаг 8: Запись и воспроизведение событий (Закомментировано) ---
    print("\n--- Шаг 8: Запись и воспроизведение ---")
    print("Этот шаг требует интерактивного ввода и закомментирован для автоматического выполнения.")
    # print("Для выполнения: раскомментируйте код ниже.")
    # print("Начало записи. Нажмите и отпустите правую кнопку, чтобы остановить.")
    # events = mouse.record()
    # print("Запись завершена.")
    # mouse.play(events[:-1])
    # print("Воспроизведение завершено.")
    # time.sleep(1)


    # --- Шаг 9: Пример: Рисование фигуры ---
    print("\n--- Шаг 9: Рисование (Квадрат и Круг) ---")
    print("ВНИМАНИЕ: Переместите курсор в пустую область (например, в Paint) для рисования!")
    time.sleep(3) # Даем время пользователю переместить курсор
    
    # 1. Рисуем квадрат
    draw_square(100)
    time.sleep(1) 
    
    # 2. Рисуем круг (начнется с последней позиции курсора)
    draw_circle(50)
    
    print("\n--- Код завершен ---")