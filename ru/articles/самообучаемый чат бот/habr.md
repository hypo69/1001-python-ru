https://habr.com/ru/articles/667008/

–û—Ç–ª–∏—á–Ω–æ! –í–æ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ–±—É—á–∞—é—â–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–≤–æ–µ–π —Å—Ç–∞—Ç—å–∏. –Ø –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª –µ—ë –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏—è–º–∏ –∏ —Å–æ–≤–µ—Ç–∞–º–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —ç—Ç–∞–ø—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å–∞–º–æ–æ–±—É—á–∞—é—â–µ–≥–æ—Å—è —á–∞—Ç-–±–æ—Ç–∞ –Ω–∞ Python —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏.

---

# üß† –°–∞–º–æ–æ–±—É—á–∞—é—â–∏–π—Å—è —á–∞—Ç-–±–æ—Ç –Ω–∞ Python —Å –ø–æ–∏—Å–∫–æ–º –≤ Wikipedia –∏ Telegram-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π

## üéØ –¶–µ–ª—å

–ù–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å Telegram-–±–æ—Ç–∞ –Ω–∞ Python, –∫–æ—Ç–æ—Ä—ã–π:

* –ü–æ–Ω–∏–º–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –Ω–∏—Ö —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ—Å—Ç–æ–≥–æ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.
* –£–º–µ–µ—Ç –∏—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–π –í–∏–∫–∏–ø–µ–¥–∏–∏.
* –°–∞–º–æ–æ–±—É—á–∞–µ—Ç—Å—è: –º–æ–∂–µ—Ç –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ–º—É –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç.

---

## üß∞ –®–∞–≥ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫

–ù–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

* **pyTelegramBotAPI** ‚Äî –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram.
* **scikit-learn** ‚Äî –¥–ª—è –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è.
* **wikipedia** ‚Äî –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏.

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏—Ö –∫–æ–º–∞–Ω–¥–æ–π:

```bash
pip install pyTelegramBotAPI wikipedia scikit-learn
```

---

## üõ† –®–∞–≥ 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª Python (–Ω–∞–ø—Ä–∏–º–µ—Ä `bot.py`) –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥:

```python
import telebot, wikipedia, re
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.linear_model import LogisticRegression
```

### –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —è–∑—ã–∫ –í–∏–∫–∏–ø–µ–¥–∏–∏ –∏ —Å–æ–∑–¥–∞—ë–º –±–æ—Ç–∞

```python
wikipedia.set_lang("ru")
bot = telebot.TeleBot('–í–ê–®_–¢–û–ö–ï–ù_–û–¢_BOTFATHER')
```

–ó–∞–º–µ–Ω–∏—Ç–µ `'–í–ê–®_–¢–û–ö–ï–ù_–û–¢_BOTFATHER'` –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç [BotFather](https://t.me/botfather) –≤ Telegram.

---

## ‚úÇÔ∏è –®–∞–≥ 3. –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞

–ë–æ—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ª—É—á—à–µ, –µ—Å–ª–∏ –º—ã —É–¥–∞–ª–∏–º –ª–∏—à–Ω–∏–µ —Å–∏–º–≤–æ–ª—ã –∏–∑ –≤—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:

```python
alphabet = ' 1234567890-–π—Ü—É–∫–µ–Ω–≥—à—â–∑—Ö—ä—Ñ—ã–≤–∞–ø—Ä–æ–ª–¥–∂—ç—è—á—Å–º–∏—Ç—å–±—é—ëqwertyuiopasdfghjklzxcvbnm?%.,()!:;'

def clean_str(r):
    r = r.lower()
    r = [c for c in r if c in alphabet]
    return ''.join(r)
```

---

## üìÅ –®–∞–≥ 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `dialogues.txt` —Ä—è–¥–æ–º —Å `bot.py`. –ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ:

```
–ø—Ä–∏–≤–µ—Ç\–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!
–∫–∞–∫ –¥–µ–ª–∞\—Ö–æ—Ä–æ—à–æ.
–∫—Ç–æ —Ç—ã\—è –î–∂–∞—Ä–≤–∏—Å.
```

–§–æ—Ä–º–∞—Ç: **–≤–æ–ø—Ä–æ—Å\–æ—Ç–≤–µ—Ç**

---

## ü§ñ –®–∞–≥ 5. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

–î–æ–±–∞–≤–∏–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–≥—Ä—É–∂–∞–µ—Ç `dialogues.txt`, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –æ–±—É—á–∞–µ—Ç –º–æ–¥–µ–ª—å:

```python
def update():
    with open('dialogues.txt', encoding='utf-8') as f:
        content = f.read()

    blocks = content.strip().split('\n')
    dataset = []

    for block in blocks:
        replicas = block.split('\\')[:2]
        if len(replicas) == 2:
            pair = [clean_str(replicas[0]), clean_str(replicas[1])]
            if pair[0] and pair[1]:
                dataset.append(pair)

    X_text = [q for q, _ in dataset]
    y = [a for _, a in dataset]

    global vectorizer, clf
    vectorizer = CountVectorizer()
    X = vectorizer.fit_transform(X_text)

    clf = LogisticRegression()
    clf.fit(X, y)

update()
```

---

## üí¨ –®–∞–≥ 6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤

–§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø–æ–¥–±–∏—Ä–∞—Ç—å –ª—É—á—à–∏–π –æ—Ç–≤–µ—Ç –ø–æ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏:

```python
def get_generative_replica(text):
    text_vector = vectorizer.transform([clean_str(text)]).toarray()[0]
    return clf.predict([text_vector])[0]
```

---

## üåê –®–∞–≥ 7. –ü–æ–∏—Å–∫ –≤ –í–∏–∫–∏–ø–µ–¥–∏–∏

–ë–æ—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∏–∫–∏–ø–µ–¥–∏—é, –µ—Å–ª–∏ –Ω–µ –Ω–∞—à—ë–ª –ø–æ–¥—Ö–æ–¥—è—â–∏–π –æ—Ç–≤–µ—Ç:

```python
def getwiki(s):
    try:
        page = wikipedia.page(s)
        text = page.content[:1000]
        sentences = text.split('.')[:-1]

        summary = ''
        for sentence in sentences:
            if '==' not in sentence and len(sentence.strip()) > 3:
                summary += sentence.strip() + '.'
            else:
                break

        summary = re.sub(r'\([^()]*\)', '', summary)
        summary = re.sub(r'\{[^\{\}]*\}', '', summary)
        return summary
    except Exception:
        return '–í –í–∏–∫–∏–ø–µ–¥–∏–∏ –Ω–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —ç—Ç–æ–º'
```

---

## ü§ù –®–∞–≥ 8. –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

```python
@bot.message_handler(commands=['start'])
def start_message(message):
    bot.send_message(message.chat.id, "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –°—ç—Ä.")

question = ""

@bot.message_handler(content_types=['text'])
def get_text_messages(message):
    global question
    command = message.text.lower()

    if command == "–Ω–µ —Ç–∞–∫":
        bot.send_message(message.from_user.id, "–∞ –∫–∞–∫?")
        bot.register_next_step_handler(message, wrong)
    else:
        question = command
        reply = get_generative_replica(command)
        if reply.strip() == "–≤–∏–∫–∏":
            bot.send_message(message.from_user.id, getwiki(command))
        else:
            bot.send_message(message.from_user.id, reply)

def wrong(message):
    correction = message.text.lower()
    with open('dialogues.txt', "a", encoding='utf-8') as f:
        f.write(f"{question}\\{correction}\n")
    bot.send_message(message.from_user.id, "–ì–æ—Ç–æ–≤–æ, —è –∑–∞–ø–æ–º–Ω–∏–ª.")
    update()
```

---

## ‚ñ∂Ô∏è –®–∞–≥ 9. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

–í –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ:

```python
bot.polling(none_stop=True)
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:

```bash
python bot.py
```

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

* –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –º–æ—â–Ω—ã–µ –º–æ–¥–µ–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä `transformers`, –¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞.
* –î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫.
* –ó–∞—â–∏—Ç–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`os.environ.get(...)`).
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —è–∑—ã–∫–æ–≤ –∏ —è–∑—ã–∫–æ–≤–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

---

## ‚úÖ –ß—Ç–æ –≤—ã —É–∑–Ω–∞–ª–∏

* –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å Telegram-–±–æ—Ç–∞ –Ω–∞ Python.
* –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ —Å `scikit-learn`.
* –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Wikipedia –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –µ—ë –∫–æ–Ω—Ç–µ–Ω—Ç.
* –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –±–æ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–∞–º–æ–æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —è –º–æ–≥—É –æ—Ñ–æ—Ä–º–∏—Ç—å —ç—Ç–æ –∫–∞–∫ PDF, HTML-—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∏–ª–∏ –ø–æ—Å—Ç –Ω–∞ –±–ª–æ–≥. –•–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å?
