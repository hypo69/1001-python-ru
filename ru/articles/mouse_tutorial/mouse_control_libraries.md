# Управление мышью в Python: Обзор и сравнение библиотек

Автоматизация действий мыши — мощный инструмент для тестирования, научных исследований, бизнес-процессов и создания вспомогательных технологий. В экосистеме Python существует несколько библиотек для этих целей, каждая из которых имеет свои сильные стороны и сценарии применения. В этой статье мы подробно рассмотрим три основные кроссплатформенные библиотеки: `PyAutoGUI`, `pynput` и `mouse`, а также кратко упомянем другие специализированные решения.

## 1. Библиотека PyAutoGUI: Высокоуровневая автоматизация GUI

`PyAutoGUI` — это мощная и простая в использовании кроссплатформенная библиотека, которая позволяет Python-скриптам управлять мышью и клавиатурой, делать скриншоты и выполнять другие задачи автоматизации графического интерфейса пользователя (GUI). Она идеально подходит для автоматизации рутинных задач, тестирования программного обеспечения и создания ботов. **Поддерживает Windows, macOS и Linux.**

### Установка

```bash
pip install pyautogui
```

### Ключевые возможности

*   **Перемещение курсора**: `pyautogui.moveTo(x, y, duration=seconds)` для абсолютного перемещения и `pyautogui.move(xOffset, yOffset, duration=seconds)` для относительного.
*   **Щелчки мыши**: `pyautogui.click()`, `pyautogui.rightClick()`, `pyautogui.doubleClick()`, `pyautogui.tripleClick()`. Можно указать координаты и кнопку.
*   **Перетаскивание (Drag and Drop)**: `pyautogui.dragTo(x, y, duration=seconds)` или `pyautogui.drag(xOffset, yOffset, duration=seconds)`.
*   **Прокрутка колеса мыши**: `pyautogui.scroll(amount)` (положительное значение — вверх, отрицательное — вниз).
*   **Взаимодействие с клавиатурой**: `pyautogui.write()`, `pyautogui.press()`, `pyautogui.hotkey()`.
*   **Получение позиции курсора**: `pyautogui.position()`.
*   **Failsafe**: Встроенная функция безопасности, которая останавливает скрипт при перемещении курсора в один из углов экрана.

### Примеры использования

```python
import pyautogui
import time

# Перемещение курсора
pyautogui.moveTo(100, 150, duration=1)
print(f"Курсор перемещен в {pyautogui.position()}")

# Клик левой кнопкой
pyautogui.click(200, 250)
print("Выполнен клик.")

# Перетаскивание
pyautogui.moveTo(500, 500, duration=0.5)
pyautogui.dragTo(600, 600, duration=1)
print("Выполнено перетаскивание.")

# Прокрутка колеса
pyautogui.scroll(-100)
print("Выполнена прокрутка вниз.")

# Ввод текста
pyautogui.write('Hello, PyAutoGUI!', interval=0.1)
print("Текст введен.")
```

### Когда использовать PyAutoGUI?

✅ Идеально подходит, если вам нужен быстрый и простой способ автоматизировать действия пользователя, имитировать ввод и делать скриншоты. Он отлично подходит для высокоуровневых скриптов автоматизации, где не требуется детальный контроль над событиями ввода.

❌ Не самый лучший выбор для низкоуровневого мониторинга событий или блокировки ввода.

## 2. Библиотека pynput: Гибкий контроль и мониторинг

`pynput` — это современный, активно поддерживаемый инструмент для полноценного мониторинга и управления устройствами ввода. Она предоставляет детальный доступ к событиям мыши и клавиатуры, включая возможность блокировать или модифицировать их в реальном времени. **Поддерживает Windows, macOS и Linux.**

### Установка

```bash
pip install pynput
```

### Ключевые возможности

*   **Полноценные слушатели событий**: `pynput.mouse.Listener` позволяет отслеживать движения, клики и прокрутку с доступом к координатам, типу кнопки и состоянию (нажата/отпущена).
*   **Блокировка событий**: Если обработчик события возвращает `False`, событие не передаётся дальше системе. Это уникальная и мощная функция.
*   **Управление мышью через контроллер**: `pynput.mouse.Controller` для эмуляции действий (позиционирование, относительное перемещение, клики, прокрутка).
*   **Единая архитектура с клавиатурой**: Легко комбинировать действия мыши и клавиатуры.
*   **Потокобезопасность**: Слушатели работают в отдельных потоках, что обеспечивает гибкое управление.

### Примеры использования

```python
from pynput import mouse
from pynput.mouse import Controller, Button
import time

# Управление мышью
mouse_ctrl = Controller()
print(f"Текущая позиция: {mouse_ctrl.position}")
mouse_ctrl.position = (100, 200)
mouse_ctrl.move(50, -50)
mouse_ctrl.click(Button.left, 1)
mouse_ctrl.scroll(0, 2)
print("Действия мыши выполнены.")

# Слушатель событий
def on_click(x, y, button, pressed):
    print(f"Клик в ({x}, {y}) кнопкой {button}. Нажата: {pressed}")
    if not pressed:
        # Остановить слушатель после отпускания кнопки
        return False

listener = mouse.Listener(on_click=on_click)
listener.start()
print("Слушатель активен. Кликните мышью.")
listener.join() # Ждем завершения слушателя
print("Слушатель завершен.")
```

### Когда использовать pynput?

✅ Идеально подходит, если вы:
- Нуждаетесь в **анализе поведения пользователя** (координаты, траектории, частота кликов).
- Создаёте **системы горячих клавиш**, **фильтры ввода** или **ассистивные технологии**.
- Хотите **блокировать или модифицировать ввод** в реальном времени.
- Делаете **научный эксперимент**, **юзабилити-тестирование** или **систему безопасности**.
- Требуется **интеграция мыши и клавиатуры** в одном скрипте.

❌ Не самый быстрый выбор, если вам нужно просто записать и повторить действия без анализа.

## 3. Библиотека mouse: Простота и запись действий

Библиотека `mouse` — это минималистичный, но эффективный инструмент для эмуляции и записи последовательностей действий мыши. Её главная «фишка» — встроенная поддержка записи и воспроизведения, что делает её идеальной для быстрого прототипирования макросов. **Поддерживает Windows, macOS и Linux.**

### Установка

```bash
pip install mouse
```

### Ключевые возможности

*   **Перемещение курсора**: `mouse.move(x, y, absolute=True/False)`.
*   **Щелчки мыши**: `mouse.click('left'/'right'/'middle')`.
*   **Перетаскивание**: `mouse.drag(x1, y1, x2, y2, absolute=True)`.
*   **Прокрутка колеса**: `mouse.wheel(delta)`.
*   **Получение позиции курсора**: `mouse.get_position()`.
*   **Проверка состояния кнопки**: `mouse.is_pressed(button)`.
*   **Запись и воспроизведение событий**: `mouse.record()` и `mouse.play()`. Это уникальная встроенная функция.
*   **Простой обработчик кликов**: `mouse.on_click(handler)`.

### Примеры использования

```python
import mouse
import time

# Перемещение и клик
mouse.move(200, 300, absolute=True, duration=0.2)
mouse.click('left')
print("Перемещение и клик выполнены.")

# Запись и воспроизведение (требует интерактивного ввода)
print("Начните запись. Нажмите правую кнопку, чтобы остановить.")
# events = mouse.record()
# print("Запись завершена. Воспроизведение...")
# mouse.play(events[:-1]) # Воспроизводим все, кроме последнего события (отпускание правой кнопки)
# print("Воспроизведение завершено.")

# Прокрутка
mouse.wheel(-2)
print("Выполнена прокрутка вниз.")
```

### Когда использовать mouse?

✅ Идеально для:
- Записи и повторного выполнения рутинных действий.
- Простых скриптов автоматизации без обратной связи.
- Обучающих примеров и демонстраций, где важна простота.

❌ Не подходит для:
- Анализа поведения пользователя (обработчики не получают координаты).
- Создания фильтров или блокировщиков ввода.
- Интеграции с клавиатурой.
- Проект не обновляется с 2021 года, что может быть риском для долгосрочных проектов.

## 4. Другие заметные библиотеки

Хотя `PyAutoGUI`, `pynput` и `mouse` являются наиболее универсальными, существуют и другие библиотеки для более специфических задач:

*   **PyDirectInput**: Специализированная библиотека, разработанная как альтернатива `PyAutoGUI` для автоматизации игр. Она может обходить проблемы, когда некоторые игры не регистрируют ввод от `PyAutoGUI` из-за их специфических механизмов обработки ввода.
*   **pywinauto**: Ориентирована на автоматизацию пользовательского интерфейса Windows. Она взаимодействует с элементами управления Windows, используя фреймворки доступности и UI Automation, что делает ее надежным выбором для автоматизации нативных приложений Windows путем нацеливания на элементы, а не на экранные координаты.

## 5. Сравнительная таблица

| Возможность / Библиотека | PyAutoGUI | pynput | mouse |
|--------------------------|:---------:|:------:|:-----:|
| **Поддерживаемые ОС**    | Windows, macOS, Linux | Windows, macOS, Linux | Windows, macOS, Linux |
|--------------------------|:---------:|:------:|:-----:|
| **Установка**            | `pip install pyautogui` | `pip install pynput` | `pip install mouse` |
| **Перемещение курсора**  | ✅ Абс./Отн. | ✅ Абс./Отн. | ✅ Абс./Отн. |
| **Щелчки мыши**          | ✅ Все типы | ✅ Все типы | ✅ Все типы |
| **Перетаскивание**       | ✅ `dragTo()` | ⚠️ Вручную | ✅ `drag()` |
| **Прокрутка колеса**     | ✅ Да       | ✅ Да    | ✅ Да   |
| **Получение позиции**    | ✅ Да       | ✅ Да    | ✅ Да   |
| **Проверка состояния кнопки** | ❌ Нет      | ⚠️ Через Listener | ✅ Да   |
| **Запись/Воспроизведение** | ❌ Нет      | ❌ Нет (только вручную) | ✅ Встроено |
| **Координаты в обработчике** | ❌ Нет      | ✅ Да    | ❌ Нет  |
| **Блокировка событий**   | ❌ Нет      | ✅ Да (`return False`) | ❌ Нет  |
| **Интеграция с клавиатурой** | ✅ Да       | ✅ Да    | ❌ Нет  |
| **Активная поддержка**   | ✅ Да       | ✅ Да    | ❌ Нет (с 2021) |
| **Failsafe**             | ✅ Да       | ❌ Нет   | ❌ Нет  |
| **Сложность API**        | Средняя     | Средняя/Высокая | Низкая |

## Заключение

Выбор библиотеки для управления мышью в Python зависит от ваших конкретных потребностей:

*   **PyAutoGUI**: Ваш выбор по умолчанию для высокоуровневой автоматизации GUI, когда вам нужно имитировать действия пользователя, включая клавиатуру и скриншоты, без глубокого анализа событий.
*   **pynput**: Идеален для проектов, требующих детального контроля над событиями мыши (и клавиатуры), мониторинга, анализа, а также возможности блокировать или модифицировать ввод в реальном времени. Это профессиональный инструмент для сложных систем.
*   **mouse**: Лучше всего подходит для простых задач записи и воспроизведения макросов, где важна максимальная простота и минимальный объем кода. Однако стоит учитывать отсутствие активной поддержки.

Для новых проектов, требующих гибкости и долгосрочной поддержки, рекомендуется начинать с `pynput`. Если же ваша задача — быстрая автоматизация рутинных действий, `PyAutoGUI` будет отличным выбором.
