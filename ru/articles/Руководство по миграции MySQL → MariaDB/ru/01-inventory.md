# –ì–õ–ê–í–ê 1: –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –∏ –∞—É–¥–∏—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

> **–¶–µ–ª—å –≥–ª–∞–≤—ã:** –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π MySQL –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

[‚Üê –ù–∞–∑–∞–¥ –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é](./00-INDEX.md) | [–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞ ‚Üí](./02-backup.md)

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –≥–ª–∞–≤—ã

1. [–í–≤–µ–¥–µ–Ω–∏–µ –∏ –≤–∞–∂–Ω–æ—Å—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏](#1-–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ê—É–¥–∏—Ç –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö](#2-–∞—É–¥–∏—Ç-–±–∞–∑-–¥–∞–Ω–Ω—ã—Ö)
3. [–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](#3-–∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
4. [–ê–Ω–∞–ª–∏–∑ —Ñ—É–Ω–∫—Ü–∏–π –∏ –æ–±—ä–µ–∫—Ç–æ–≤](#4-–∞–Ω–∞–ª–∏–∑-—Ñ—É–Ω–∫—Ü–∏–π-–∏-–æ–±—ä–µ–∫—Ç–æ–≤)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏](#5-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏)
6. [–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏](#6-–∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
7. [–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏](#7-–∞–Ω–∞–ª–∏–∑-–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)
8. [–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π](#8-–ø—Ä–æ–≤–µ—Ä–∫–∞-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
9. [–û—Ü–µ–Ω–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏](#9-–æ—Ü–µ–Ω–∫–∞-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
10. [–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞](#10-—Å–æ–∑–¥–∞–Ω–∏–µ-–æ—Ç—á–µ—Ç–∞)

---

## 1. –í–≤–µ–¥–µ–Ω–∏–µ –∏ –≤–∞–∂–Ω–æ—Å—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏

### 1.1 –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è

–ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è ‚Äî —ç—Ç–æ **—Ñ—É–Ω–¥–∞–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏**. –ë–µ–∑ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º –≤–æ–∑—Ä–∞—Å—Ç–∞–µ—Ç –≤ —Ä–∞–∑—ã.

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
```plaintext
–ü—Ä–æ–µ–∫—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î:
- –° –ø–æ–ª–Ω–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–µ–π: 95% —É—Å–ø–µ—à–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- –ë–µ–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏: 60% —É—Å–ø–µ—à–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- –°—Ä–µ–¥–Ω–∏–π downtime —Å –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–µ–π: 15 –º–∏–Ω—É—Ç
- –°—Ä–µ–¥–Ω–∏–π downtime –±–µ–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–∏: 4+ —á–∞—Å–∞
```

### 1.2 –ß—Ç–æ –º—ã –±—É–¥–µ–º —Å–æ–±–∏—Ä–∞—Ç—å

–ü–æ–ª–Ω–∞—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:

#### üìä –î–∞–Ω–Ω—ã–µ
- –†–∞–∑–º–µ—Ä –∫–∞–∂–¥–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–±–ª–∏—Ü –∏ –∑–∞–ø–∏—Å–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ storage engines
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–Ω–¥–µ–∫—Å–æ–≤
- Foreign keys –∏ constraints

#### üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –∏ —Ä–æ–ª–∏
- Authentication plugins
- SSL/TLS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

#### üîß –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- Stored procedures –∏ functions
- Triggers
- Events (scheduled tasks)
- Views
- Partitioned tables

#### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–µ—Ä–≤–µ—Ä–∞
- Performance variables
- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- Plugin'—ã

#### üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –ò–Ω–¥–µ–∫—Å—ã –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- Buffer pool —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- Connection patterns

#### üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ü–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã
- External tools –∏ utilities

### 1.3 –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å:

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã MySQL
which mysql mysqldump mysqladmin

# Percona Toolkit (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
sudo apt install percona-toolkit -y

# –£—Ç–∏–ª–∏—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
sudo apt install -y \
    sysstat \
    htop \
    iotop \
    nethogs \
    mytop
```

### 1.4 –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∞—É–¥–∏—Ç–∞ —Å –ø—Ä–∞–≤–∞–º–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —á—Ç–µ–Ω–∏–µ:

```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –∞—É–¥–∏—Ç-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE USER 'audit'@'localhost' IDENTIFIED BY 'AuditPassword123!';

-- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∞
GRANT SELECT ON *.* TO 'audit'@'localhost';
GRANT PROCESS ON *.* TO 'audit'@'localhost';
GRANT REPLICATION CLIENT ON *.* TO 'audit'@'localhost';
GRANT SHOW DATABASES ON *.* TO 'audit'@'localhost';
GRANT SHOW VIEW ON *.* TO 'audit'@'localhost';

-- –î–ª—è Performance Schema
GRANT SELECT ON performance_schema.* TO 'audit'@'localhost';
GRANT SELECT ON information_schema.* TO 'audit'@'localhost';

FLUSH PRIVILEGES;
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤:**
```bash
mysql -u audit -p -e "SHOW GRANTS FOR 'audit'@'localhost';"
```

---

## 2. –ê—É–¥–∏—Ç –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

### 2.1 –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏

–≠—Ç–æ –ø–µ—Ä–≤—ã–π –∏ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π —à–∞–≥ ‚Äî –ø–æ–Ω—è—Ç—å, —Å–∫–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã—Ö –≤–∞–º –ø—Ä–µ–¥—Å—Ç–æ–∏—Ç –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å.

#### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

```sql
SELECT 
    table_schema AS 'Database',
    COUNT(*) AS 'Tables',
    ROUND(SUM(data_length) / 1024 / 1024, 2) AS 'Data Size (MB)',
    ROUND(SUM(index_length) / 1024 / 1024, 2) AS 'Index Size (MB)',
    ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Total Size (MB)',
    ROUND(SUM(data_free) / 1024 / 1024, 2) AS 'Free Space (MB)'
FROM information_schema.tables
GROUP BY table_schema
ORDER BY SUM(data_length + index_length) DESC;
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```plaintext
+--------------------+--------+----------------+-----------------+-----------------+------------------+
| Database           | Tables | Data Size (MB) | Index Size (MB) | Total Size (MB) | Free Space (MB)  |
+--------------------+--------+----------------+-----------------+-----------------+------------------+
| production_db      | 234    | 38234.56       | 7443.76         | 45678.32        | 1234.50          |
| analytics_db       | 89     | 10123.45       | 2222.22         | 12345.67        | 456.78           |
| staging_db         | 234    | 4567.89        | 1111.01         | 5678.90         | 123.45           |
| test_db            | 156    | 890.12         | 234.56          | 1124.68         | 45.67            |
| information_schema | 79     | 0.00           | 0.00            | 0.16            | 0.00             |
| mysql              | 31     | 1.89           | 0.59            | 2.48            | 0.00             |
| performance_schema | 87     | 0.00           | 0.00            | 0.00            | 0.00             |
+--------------------+--------+----------------+-----------------+-----------------+------------------+
```

#### –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–µ–π

```sql
SELECT 
    table_schema AS 'Database',
    COUNT(*) AS 'Tables',
    ROUND(SUM(data_length) / 1024 / 1024, 2) AS 'Data (MB)',
    ROUND(SUM(index_length) / 1024 / 1024, 2) AS 'Index (MB)',
    ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Total (MB)',
    ROUND(SUM(data_free) / 1024 / 1024, 2) AS 'Free (MB)',
    ROUND(SUM(data_free) / NULLIF(SUM(data_length + index_length), 0) * 100, 2) AS 'Fragmentation %'
FROM information_schema.tables
WHERE table_schema NOT IN ('information_schema', 'performance_schema', 'mysql', 'sys')
GROUP BY table_schema
ORDER BY SUM(data_length + index_length) DESC;
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**

| Fragmentation % | –°–æ—Å—Ç–æ—è–Ω–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|-----------------|-----------|----------|
| 0-5% | –û—Ç–ª–∏—á–Ω–æ | –ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π |
| 5-15% | –•–æ—Ä–æ—à–æ | –ú–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å |
| 15-30% | –°—Ä–µ–¥–Ω–µ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è OPTIMIZE |
| >30% | –ü–ª–æ—Ö–æ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ OPTIMIZE –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π |

### 2.2 –ê–Ω–∞–ª–∏–∑ storage engines

–í–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–∏–µ –¥–≤–∏–∂–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –Ω–µ –≤—Å–µ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å MariaDB.

```sql
SELECT 
    engine AS 'Storage Engine',
    COUNT(*) AS 'Tables',
    ROUND(SUM(data_length) / 1024 / 1024, 2) AS 'Data (MB)',
    ROUND(SUM(index_length) / 1024 / 1024, 2) AS 'Index (MB)',
    ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Total (MB)',
    ROUND(SUM(data_length + index_length) / SUM(SUM(data_length + index_length)) OVER () * 100, 2) AS 'Percentage %'
FROM information_schema.tables
WHERE table_schema NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys')
GROUP BY engine
ORDER BY SUM(data_length + index_length) DESC;
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```plaintext
+----------------+--------+-----------+------------+--------------+--------------+
| Storage Engine | Tables | Data (MB) | Index (MB) | Total (MB)   | Percentage % |
+----------------+--------+-----------+------------+--------------+--------------+
| InnoDB         | 687    | 52345.67  | 10234.56   | 62580.23     | 98.45        |
| MyISAM         | 23     | 890.12    | 123.45     | 1013.57      | 1.59         |
| MEMORY         | 5      | 0.23      | 0.00       | 0.23         | 0.00         |
| CSV            | 2      | 0.01      | 0.00       | 0.01         | 0.00         |
+----------------+--------+-----------+------------+--------------+--------------+
```

#### –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å storage engines

| Engine | MariaDB –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|----------------------|--------------|
| **InnoDB** | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| **MyISAM** | ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ InnoDB |
| **MEMORY (HEAP)** | ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| **CSV** | ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| **Archive** | ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| **Blackhole** | ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| **NDB (Cluster)** | ‚ùå –ù–ï –°–û–í–ú–ï–°–¢–ò–ú | –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ |
| **Federated** | ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º | –í MariaDB –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è FederatedX |

**‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ:** –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ NDB engine, –º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ MariaDB –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞. –í–∞–º –Ω—É–∂–Ω–æ –ª–∏–±–æ –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞ MySQL Cluster, –ª–∏–±–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å NDB —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ InnoDB.

### 2.3 –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º

#### –°–ø–∏—Å–æ–∫ –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö —Ç–∞–±–ª–∏—Ü

```sql
SELECT 
    table_schema AS 'Database',
    table_name AS 'Table',
    engine AS 'Engine',
    table_rows AS 'Row Count',
    ROUND(data_length / 1024 / 1024, 2) AS 'Data (MB)',
    ROUND(index_length / 1024 / 1024, 2) AS 'Index (MB)',
    ROUND((data_length + index_length) / 1024 / 1024, 2) AS 'Total (MB)',
    ROUND(data_free / 1024 / 1024, 2) AS 'Free (MB)',
    ROUND(data_free / (data_length + index_length) * 100, 2) AS 'Frag %'
FROM information_schema.tables
WHERE table_schema NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys')
  AND table_type = 'BASE TABLE'
ORDER BY (data_length + index_length) DESC
LIMIT 20;
```

#### –¢–∞–±–ª–∏—Ü—ã –±–µ–∑ primary key (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞)

```sql
SELECT 
    t.table_schema AS 'Database',
    t.table_name AS 'Table',
    t.engine AS 'Engine',
    t.table_rows AS 'Rows',
    ROUND((t.data_length + t.index_length) / 1024 / 1024, 2) AS 'Size (MB)'
FROM information_schema.tables t
LEFT JOIN information_schema.statistics s 
    ON t.table_schema = s.table_schema 
    AND t.table_name = s.table_name 
    AND s.index_name = 'PRIMARY'
WHERE t.table_schema NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys')
  AND t.table_type = 'BASE TABLE'
  AND s.index_name IS NULL
ORDER BY t.table_rows DESC;
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –¢–∞–±–ª–∏—Ü—ã –±–µ–∑ PRIMARY KEY –º–µ–¥–ª–µ–Ω–Ω–µ–µ –≤ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
- –ú–æ–≥—É—Ç –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ Galera Cluster
- –ó–∞—Ç—Ä—É–¥–Ω—è—é—Ç point-in-time recovery

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤—å—Ç–µ PRIMARY KEY –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π:
```sql
ALTER TABLE your_table ADD PRIMARY KEY (id);
-- –∏–ª–∏ –µ—Å–ª–∏ –Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–π –∫–æ–ª–æ–Ω–∫–∏:
ALTER TABLE your_table ADD COLUMN id BIGINT PRIMARY KEY AUTO_INCREMENT FIRST;
```

### 2.4 –ê–Ω–∞–ª–∏–∑ –∏–Ω–¥–µ–∫—Å–æ–≤

#### –ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã

```sql
SELECT 
    object_schema AS 'Database',
    object_name AS 'Table',
    index_name AS 'Index',
    ROUND(stat_value * @@innodb_page_size / 1024 / 1024, 2) AS 'Index Size (MB)'
FROM mysql.innodb_index_stats
WHERE stat_name = 'size'
  AND object_schema NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys')
  AND index_name NOT IN ('PRIMARY', 'GEN_CLUST_INDEX')
  AND index_name NOT IN (
      SELECT DISTINCT index_name
      FROM performance_schema.table_io_waits_summary_by_index_usage
      WHERE object_schema = innodb_index_stats.object_schema
        AND object_name = innodb_index_stats.object_name
        AND index_name = innodb_index_stats.index_name
        AND count_star > 0
  )
ORDER BY stat_value DESC
LIMIT 20;
```

#### –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∏–Ω–¥–µ–∫—Å—ã

```sql
SELECT 
    s1.table_schema AS 'Database',
    s1.table_name AS 'Table',
    s1.index_name AS 'Index 1',
    s2.index_name AS 'Index 2',
    GROUP_CONCAT(s1.column_name ORDER BY s1.seq_in_index) AS 'Columns'
FROM information_schema.statistics s1
JOIN information_schema.statistics s2 
    ON s1.table_schema = s2.table_schema
    AND s1.table_name = s2.table_name
    AND s1.index_name < s2.index_name
    AND s1.column_name = s2.column_name
    AND s1.seq_in_index = s2.seq_in_index
WHERE s1.table_schema NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys')
GROUP BY s1.table_schema, s1.table_name, s1.index_name, s2.index_name
HAVING COUNT(*) = (
    SELECT COUNT(*) 
    FROM information_schema.statistics 
    WHERE table_schema = s1.table_schema 
      AND table_name = s1.table_name 
      AND index_name = s1.index_name
);
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–¥–∞–ª–∏—Ç–µ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π ‚Äî —ç—Ç–æ —É—Å–∫–æ—Ä–∏—Ç –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö.

### 2.5 –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤—Å–µ—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

```bash
#!/bin/bash
# export_database_structure.sh

OUTPUT_DIR="./db_structure_$(date +%Y%m%d)"
mkdir -p "$OUTPUT_DIR"

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
DATABASES=$(mysql -u audit -p -N -e "
    SELECT schema_name 
    FROM information_schema.schemata 
    WHERE schema_name NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys');
")

# –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞–∂–¥–æ–π –±–∞–∑—ã
for DB in $DATABASES; do
    echo "Exporting structure: $DB..."
    
    mysqldump \
        --user=audit \
        --password \
        --no-data \
        --routines \
        --triggers \
        --events \
        --single-transaction \
        "$DB" > "$OUTPUT_DIR/${DB}_structure.sql"
    
    echo "Exported: $DB"
done

echo "All database structures exported to: $OUTPUT_DIR"
```

### 2.6 –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã

–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–¥–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:

```bash
#!/bin/bash
# create_database_inventory.sh

OUTPUT_FILE="database_inventory_$(date +%Y%m%d).csv"

mysql -u audit -p -e "
SELECT 
    table_schema AS 'Database',
    COUNT(*) AS 'Tables',
    SUM(table_rows) AS 'Total Rows',
    ROUND(SUM(data_length) / 1024 / 1024, 2) AS 'Data MB',
    ROUND(SUM(index_length) / 1024 / 1024, 2) AS 'Index MB',
    ROUND(SUM(data_length + index_length) / 1024 / 1024, 2) AS 'Total MB',
    GROUP_CONCAT(DISTINCT engine) AS 'Engines'
FROM information_schema.tables
WHERE table_schema NOT IN ('information_schema', 'mysql', 'performance_schema', 'sys')
GROUP BY table_schema
ORDER BY SUM(data_length + index_length) DESC;
" | sed 's/\t/,/g' > "$OUTPUT_FILE"

echo "Inventory saved to: $OUTPUT_FILE"
```

---

## 3. –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

### 3.1 –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```sql
SELECT 
    User AS 'Username',
    Host AS 'Host',
    plugin AS 'Auth Plugin',
    password_expired AS 'Password Expired',
    password_lifetime AS 'Password Lifetime',
    account_locked AS 'Account Locked',
    password_last_changed AS 'Password Changed',
    authentication_string != '' AS 'Has Password'
FROM mysql.user
ORDER BY User, Host;
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```plaintext
+--------------+-------------+------------------------+------------------+-------------------+----------------+---------------------+--------------+
| Username     | Host        | Auth Plugin            | Password Expired | Password Lifetime | Account Locked | Password Changed    | Has Password |
+--------------+-------------+------------------------+------------------+-------------------+----------------+---------------------+--------------+
| admin        | localhost   | mysql_native_password  | N                | NULL              | N              | 2025-10-15 10:30:00 | 1            |
| app_user     | 192.168.1.% | mysql_native_password  | N                | NULL              | N              | 2025-10-20 14:22:00 | 1            |
| backup       | localhost   | mysql_native_password  | N                | NULL              | N              | 2025-09-01 08:15:00 | 1            |
| monitor      | localhost   | mysql_native_password  | N                | NULL              | N              | 2025-10-01 09:00:00 | 1            |
| repl         | 10.0.0.%    | mysql_native_password  | N                | NULL              | N              | 2025-08-15 12:45:00 | 1            |
| root         | localhost   | auth_socket            | N                | NULL              | N              | NULL                | 0            |
+--------------+-------------+------------------------+------------------+-------------------+----------------+---------------------+--------------+
```

### 3.2 –ê–Ω–∞–ª–∏–∑ authentication plugins

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫–∏–µ –ø–ª–∞–≥–∏–Ω—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:

```sql
SELECT 
    plugin AS 'Auth Plugin',
    COUNT(*) AS 'User Count',
    GROUP_CONCAT(CONCAT(User, '@', Host) SEPARATOR ', ') AS 'Users'
FROM mysql.user
WHERE User != ''
GROUP BY plugin
ORDER BY COUNT(*) DESC;
```

**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–ª–∞–≥–∏–Ω–æ–≤:**

| Plugin MySQL | Plugin MariaDB | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –î–µ–π—Å—Ç–≤–∏–µ |
|--------------|----------------|---------------|----------|
| `mysql_native_password` | `mysql_native_password` | ‚úÖ –ü–æ–ª–Ω–∞—è | –ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π |
| `caching_sha2_password` | `mysql_native_password` | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è | –ù—É–∂–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è |
| `auth_socket` / `unix_socket` | `unix_socket` | ‚úÖ –ü–æ–ª–Ω–∞—è | –ù–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π |
| `sha256_password` | N/A | ‚ùå –ù–µ—Ç | –ù—É–∂–Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è |

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `caching_sha2_password`:**
```sql
-- –ù–∞–π—Ç–∏ —Ç–∞–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT User, Host 
FROM mysql.user 
WHERE plugin = 'caching_sha2_password';

-- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å (–ø–æ—Ç—Ä–µ–±—É–µ—Ç —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è)
ALTER USER 'username'@'host' IDENTIFIED WITH mysql_native_password BY 'new_password';
```

### 3.3 –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

#### –ú–µ—Ç–æ–¥ 1: –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±

```bash
#!/bin/bash
# export_user_grants.sh

OUTPUT_FILE="user_grants_$(date +%Y%m%d).sql"

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
mysql -u audit -p -N -e "
    SELECT DISTINCT CONCAT('SHOW GRANTS FOR ''', User, '''@''', Host, ''';') 
    FROM mysql.user 
    WHERE User NOT IN ('root', 'mysql.sys', 'mysql.session', 'mysql.infoschema')
      AND User != '';
" | while read query; do
    mysql -u root -p -N -e "$query" | sed 's/$/;/'
done > "$OUTPUT_FILE"

echo "Grants exported to: $OUTPUT_FILE"
```

#### –ú–µ—Ç–æ–¥ 2: Percona Toolkit (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–π –º–µ—Ç–æ–¥
pt-show-grants \
    --host=localhost \
    --user=root \
    --ask-pass \
    > user_grants_$(date +%Y%m%d).sql
```

### 3.4 –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –æ–ø–∞—Å–Ω—ã–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å SUPER –ø—Ä–∏–≤–∏–ª–µ–≥–∏–µ–π
SELECT User, Host 
FROM mysql.user 
WHERE Super_priv = 'Y' 
  AND User NOT IN ('root');

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫–æ –≤—Å–µ–º –±–∞–∑–∞–º
SELECT 
    User, 
    Host,
    GROUP_CONCAT(DISTINCT Db) AS 'Databases'
FROM mysql.db
WHERE Db = '%' OR Db = '*'
GROUP BY User, Host;

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º –æ—Ç–æ–≤—Å—é–¥—É
SELECT User, Host
FROM mysql.user
WHERE Host = '%'
  AND User != '';
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
1. –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ SUPER –ø—Ä–∏–≤–∏–ª–µ–≥–∏—é —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º
2. –ò–∑–±–µ–≥–∞–π—Ç–µ `%` –≤ Host - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ IP/–ø–æ–¥—Å–µ—Ç–∏
3. –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

### 3.5 –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã –¥–æ—Å—Ç—É–ø–∞

```sql
-- –ú–∞—Ç—Ä–∏—Ü–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –±–∞–∑–∞ ‚Üí –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏
SELECT 
    CONCAT(User, '@', Host) AS 'User@Host',
    Db AS 'Database',
    CONCAT(
        IF(Select_priv = 'Y', 'SELECT ', ''),
        IF(Insert_priv = 'Y', 'INSERT ', ''),
        IF(Update_priv = 'Y', 'UPDATE ', ''),
        IF(Delete_priv = 'Y', 'DELETE ', ''),
        IF(Create_priv = 'Y', 'CREATE ', ''),
        IF(Drop_priv = 'Y', 'DROP ', ''),
        IF(Grant_priv = 'Y', 'GRANT ', ''),
        IF(Index_priv = 'Y', 'INDEX ', ''),
        IF(Alter_priv = 'Y', 'ALTER ', '')
    ) AS 'Privileges'
FROM mysql.db
WHERE User != ''
ORDER BY User, Host, Db;
```

### 3.6 –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–°–æ–∑–¥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

```bash
#!/bin/bash
# document_users.sh

cat > user_documentation_$(date +%Y%m%d).md << 'EOF'
# MySQL User Documentation

## User Inventory

| Username | Host | Purpose | Used By | Critical |
|----------|------|---------|---------|----------|
EOF

mysql -u audit -p -N -e "
SELECT CONCAT(
    '| ', User, 
    ' | ', Host, 
    ' | [PURPOSE] ',
    ' | [APPS] ',
    ' | [Y/N] |'
)
FROM mysql.user
WHERE User NOT IN ('root', 'mysql.sys', 'mysql.session', 'mysql.infoschema')
  AND User != ''
ORDER BY User, Host;
" >> user_documentation_$(date +%Y%m%d).md

echo "User documentation template created"
echo "Please fill in [PURPOSE], [APPS], and [Y/N] fields"
```

---

## 4. –ê–Ω–∞–ª–∏–∑ —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä, —Ñ—É–Ω–∫—Ü–∏–π –∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

### 4.1 –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è stored routines

```sql
SELECT 
    ROUTINE_SCHEMA AS 'Database',
    ROUTINE_TYPE AS 'Type',
    ROUTINE_NAME AS 'Name',
    DTD_IDENTIFIER AS 'Returns',
    IS_DETERMINISTIC AS 'Deterministic',
    SQL_DATA_ACCESS AS 'Data Access',
    DEFINER AS 'Definer',
    CREATED AS 'Created',
    LAST_ALTERED AS 'Modified'
FROM information_schema.ROUTINES
WHERE ROUTINE_SCHEMA NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys')
ORDER BY ROUTINE_SCHEMA, ROUTINE_TYPE, ROUTINE_NAME;
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```plaintext
+---------------+-----------+----------------------+---------+---------------+-------------+-------------------+---------------------+---------------------+
| Database      | Type      | Name                 | Returns | Deterministic | Data Access | Definer           | Created             | Modified            |
+---------------+-----------+----------------------+---------+---------------+-------------+-------------------+---------------------+---------------------+
| production_db | FUNCTION  | calculate_discount   | decimal | YES           | READS SQL   | admin@localhost   | 2024-05-12 10:30:00 | 2025-08-15 14:20:00 |
| production_db | FUNCTION  | get_user_status      | varchar | NO            | READS SQL   | admin@localhost   | 2024-03-20 09:15:00 | 2024-03-20 09:15:00 |
| production_db | PROCEDURE | cleanup_old_orders   | NULL    | NO            | MODIFIES    | admin@localhost   | 2024-06-01 11:00:00 | 2025-09-10 16:45:00 |
| production_db | PROCEDURE | generate_report      | NULL    | NO            | READS SQL   | admin@localhost   | 2024-07-15 13:30:00 | 2025-10-01 10:00:00 |
+---------------+-----------+----------------------+---------+---------------+-------------+-------------------+---------------------+---------------------+
```

### 4.2 –≠–∫—Å–ø–æ—Ä—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π routines

```bash
#!/bin/bash
# export_routines.sh

OUTPUT_DIR="./routines_$(date +%Y%m%d)"
mkdir -p "$OUTPUT_DIR"

# –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –±–∞–∑
DATABASES=$(mysql -u audit -p -N -e "
    SELECT DISTINCT ROUTINE_SCHEMA
    FROM information_schema.ROUTINES
    WHERE ROUTINE_SCHEMA NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys');
")

for DB in $DATABASES; do
    echo "Exporting routines from: $DB..."
    
    # –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ—Ü–µ–¥—É—Ä –∏ —Ñ—É–Ω–∫—Ü–∏–π
    mysqldump \
        --user=audit \
        --password \
        --no-create-info \
        --no-data \
        --routines \
        --skip-triggers \
        --databases "$DB" \
        > "$OUTPUT_DIR/${DB}_routines.sql"
done

echo "Routines exported to: $OUTPUT_DIR"
```

### 4.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ DEFINER

–ü—Ä–æ–±–ª–µ–º–∞ —Å DEFINER ‚Äî —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:

```sql
-- –ü—Ä–æ—Ü–µ–¥—É—Ä—ã/—Ñ—É–Ω–∫—Ü–∏–∏ —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ DEFINER'–∞–º–∏
SELECT 
    r.ROUTINE_SCHEMA AS 'Database',
    r.ROUTINE_TYPE AS 'Type',
    r.ROUTINE_NAME AS 'Name',
    r.DEFINER AS 'Definer'
FROM information_schema.ROUTINES r
LEFT JOIN mysql.user u 
    ON r.DEFINER = CONCAT(u.User, '@', u.Host)
WHERE r.ROUTINE_SCHEMA NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys')
  AND u.User IS NULL
ORDER BY r.ROUTINE_SCHEMA, r.ROUTINE_NAME;
```

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π –ª–∏–±–æ:
1. –°–æ–∑–¥–∞–π—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. –ò–∑–º–µ–Ω–∏—Ç–µ DEFINER –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –£–¥–∞–ª–∏—Ç–µ DEFINER –∏–∑ –¥–∞–º–ø–∞ (–æ–Ω –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫–∞–∫ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)

### 4.4 –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

```sql
SELECT 
    TRIGGER_SCHEMA AS 'Database',
    TRIGGER_NAME AS 'Trigger',
    EVENT_MANIPULATION AS 'Event',
    EVENT_OBJECT_TABLE AS 'Table',
    ACTION_TIMING AS 'Timing',
    ACTION_STATEMENT AS 'Action',
    DEFINER AS 'Definer',
    CREATED AS 'Created'
FROM information_schema.TRIGGERS
WHERE TRIGGER_SCHEMA NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys')
ORDER BY TRIGGER_SCHEMA, EVENT_OBJECT_TABLE, TRIGGER_NAME;
```

### 4.5 –≠–∫—Å–ø–æ—Ä—Ç —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤

```bash
#!/bin/bash
# export_triggers.sh

OUTPUT_DIR="./triggers_$(date +%Y%m%d)"
mkdir -p "$OUTPUT_DIR"

DATABASES=$(mysql -u audit -p -N -e "
    SELECT DISTINCT TRIGGER_SCHEMA
    FROM information_schema.TRIGGERS
    WHERE TRIGGER_SCHEMA NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys');
")

for DB in $DATABASES; do
    echo "Exporting triggers from: $DB..."
    
    mysqldump \
        --user=audit \
        --password \
        --no-create-info \
        --no-data \
        --triggers \
        --skip-routines \
        --databases "$DB" \
        > "$OUTPUT_DIR/${DB}_triggers.sql"
done

echo "Triggers exported to: $OUTPUT_DIR"
```

### 4.6 –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è events (scheduled tasks)

```sql
SELECT 
    EVENT_SCHEMA AS 'Database',
    EVENT_NAME AS 'Event',
    STATUS AS 'Status',
    EVENT_TYPE AS 'Type',
    EXECUTE_AT AS 'Execute At',
    INTERVAL_VALUE AS 'Interval Value',
    INTERVAL_FIELD AS 'Interval Unit',
    STARTS AS 'Starts',
    ENDS AS 'Ends',
    ON_COMPLETION AS 'On Completion',
    DEFINER AS 'Definer',
    CREATED AS 'Created',
    LAST_ALTERED AS 'Modified',
    LAST_EXECUTED AS 'Last Executed'
FROM information_schema.EVENTS
WHERE EVENT_SCHEMA NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys')
ORDER BY EVENT_SCHEMA, EVENT_NAME;
```

### 4.7 –ü—Ä–æ–≤–µ—Ä–∫–∞ views

```sql
SELECT 
    TABLE_SCHEMA AS 'Database',
    TABLE_NAME AS 'View Name',
    DEFINER AS 'Definer',
    SECURITY_TYPE AS 'Security',
    IS_UPDATABLE AS 'Updatable',
    CHECK_OPTION AS 'Check Option'
FROM information_schema.VIEWS
WHERE TABLE_SCHEMA NOT IN ('mysql', 'information_schema', 'performance_schema', 'sys')
ORDER BY TABLE_SCHEMA, TABLE_NAME;
```

---

## 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

### 5.1 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

–ü–µ—Ä–≤—ã–π —à–∞–≥ ‚Äî –ø–æ–Ω—è—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –∫–∞–∫–∞—è —Ç–æ–ø–æ–ª–æ–≥–∏—è.

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞: —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä Master
mysql -u audit -p -e "SHOW MASTER STATUS\G"

# –ü—Ä–æ–≤–µ—Ä–∫–∞: —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä Slave
mysql -u audit -p -e "SHOW SLAVE STATUS\G"
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Ç–æ–ø–æ–ª–æ–≥–∏–∏:**

#### Standalone (–Ω–µ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   MySQL     ‚îÇ
‚îÇ  Standalone ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Master-Slave
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Master ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚ñº      ‚ñº      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Slave1 ‚îÇ‚îÇ Slave2 ‚îÇ‚îÇ Slave3 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Master-Master
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚Üê‚Üí ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Master1 ‚îÇ    ‚îÇ Master2 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Multi-Source Replication
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Master1 ‚îÇ    ‚îÇ Master2 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ              ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚ñº
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ  Slave  ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 5.2 –ê–Ω–∞–ª–∏–∑ Master —Å—Ç–∞—Ç—É—Å–∞

–ï—Å–ª–∏ —ç—Ç–æ Master —Å–µ—Ä–≤–µ—Ä:

```sql
-- –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å master
SHOW MASTER STATUS;

-- –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö slave —Å–µ—Ä–≤–µ—Ä–æ–≤
SHOW SLAVE HOSTS;

-- Binary log —Ñ–∞–π–ª—ã
SHOW BINARY LOGS;
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ SHOW MASTER STATUS:**
```plaintext
+--------------------+----------+--------------+------------------+-------------------+
| File               | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+--------------------+----------+--------------+------------------+-------------------+
| mysql-bin.000023   | 45678901 | production   |                  | uuid:1-1234567    |
+--------------------+----------+--------------+------------------+-------------------+
```

**–í–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- **File**: –¢–µ–∫—É—â–∏–π binlog —Ñ–∞–π–ª
- **Position**: –ü–æ–∑–∏—Ü–∏—è –≤ —Ñ–∞–π–ª–µ
- **Executed_Gtid_Set**: –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è GTID

### 5.3 –ê–Ω–∞–ª–∏–∑ Slave —Å—Ç–∞—Ç—É—Å–∞

–ï—Å–ª–∏ —ç—Ç–æ Slave —Å–µ—Ä–≤–µ—Ä:

```sql
SHOW SLAVE STATUS\G
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**

```plaintext
*************************** 1. row ***************************
               Slave_IO_State: Waiting for master to send event
                  Master_Host: 192.168.1.100
                  Master_User: repl
                  Master_Port: 3306
                Connect_Retry: 60
              Master_Log_File: mysql-bin.000023
          Read_Master_Log_Pos: 45678901
               Relay_Log_File: mysql-relay-bin.000015
                Relay_Log_Pos: 12345678
        Relay_Master_Log_File: mysql-bin.000023
             Slave_IO_Running: Yes                    ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å Yes
            Slave_SQL_Running: Yes                    ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å Yes
              Replicate_Do_DB: production,analytics
          Replicate_Ignore_DB: 
           Replicate_Do_Table: 
       Replicate_Ignore_Table: 
      Replicate_Wild_Do_Table: 
  Replicate_Wild_Ignore_Table: 
                   Last_Errno: 0                       ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0
                   Last_Error:                         ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ
                 Skip_Counter: 0
          Exec_Master_Log_Pos: 45678901
              Relay_Log_Space: 23456789
        Seconds_Behind_Master: 0                       ‚Üê –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 –∏–ª–∏ –º–∞–ª–æ–µ —á–∏—Å–ª–æ
                Last_IO_Errno: 0
                Last_IO_Error: 
               Last_SQL_Errno: 0
               Last_SQL_Error: 
         Executed_Gtid_Set: uuid:1-1234567
            Auto_Position: 1
     Replicate_Rewrite_DB: 
             Channel_Name: 
```

### 5.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ GTID

```sql
-- MySQL
SELECT @@gtid_mode;
SELECT @@gtid_executed;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ GTID
SELECT @@gtid_purged;
```

**‚ö†Ô∏è –í–∞–∂–Ω–æ:** MySQL –∏ MariaDB –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ** —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ GTID!

| –ü–∞—Ä–∞–º–µ—Ç—Ä | MySQL | MariaDB | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |
|----------|-------|---------|---------------|
| GTID Format | UUID:transaction_id | domain-server-sequence | ‚ùå –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ |
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | `gtid_mode` | `gtid_strict_mode` | –†–∞–∑–Ω—ã–µ |
| Executed | `@@gtid_executed` | `@@gtid_current_pos` | –†–∞–∑–Ω—ã–µ |

**–°–ª–µ–¥—Å—Ç–≤–∏–µ:** –ù–µ–ª—å–∑—è —Å–¥–µ–ª–∞—Ç—å MariaDB slave'–æ–º MySQL master'–∞ —á–µ—Ä–µ–∑ GTID. –ù—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å position-based —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é.

### 5.5 –ê–Ω–∞–ª–∏–∑ binlog —Ñ–æ—Ä–º–∞—Ç–∞

```sql
SELECT @@binlog_format;
```

**–¢–∏–ø—ã binlog —Ñ–æ—Ä–º–∞—Ç–æ–≤:**

| Format | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|----------|--------------|
| **STATEMENT** | –õ–æ–≥–∏—Ä—É–µ—Ç SQL –∫–æ–º–∞–Ω–¥—ã | –£—Å—Ç–∞—Ä–µ–ª–æ, –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| **ROW** | –õ–æ–≥–∏—Ä—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ | ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è |
| **MIXED** | –ö–æ–º–±–∏–Ω–∞—Ü–∏—è STATEMENT –∏ ROW | –í–æ–∑–º–æ–∂–Ω—ã –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ |

**–î–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **ROW** —Ñ–æ—Ä–º–∞—Ç ‚Äî –æ–Ω –Ω–∞–∏–±–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–µ–Ω.

### 5.6 –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏

```bash
#!/bin/bash
# document_replication.sh

cat > replication_doc_$(date +%Y%m%d).md << 'EOF'
# MySQL Replication Documentation

## Topology
[–ù–∞—Ä–∏—Å—É–π—Ç–µ —Ç–æ–ø–æ–ª–æ–≥–∏—é]

## Master Configuration
EOF

# Master status
echo "### Master Status" >> replication_doc_$(date +%Y%m%d).md
mysql -u audit -p -e "SHOW MASTER STATUS\G" >> replication_doc_$(date +%Y%m%d).md

# Slave status (–µ—Å–ª–∏ —ç—Ç–æ slave)
echo -e "\n### Slave Status" >> replication_doc_$(date +%Y%m%d).md
mysql -u audit -p -e "SHOW SLAVE STATUS\G" >> replication_doc_$(date +%Y%m%d).md

# Binary log files
echo -e "\n### Binary Logs" >> replication_doc_$(date +%Y%m%d).md
mysql -u audit -p -e "SHOW BINARY LOGS;" >> replication_doc_$(date +%Y%m%d).md

echo "Replication documentation created"
```

---

*–ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –≥–ª–∞–≤—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ—Ç–≤–µ—Ç–µ –∏–∑-–∑–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã...*

**–°–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã:**
- 6. –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- 7. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- 9. –û—Ü–µ–Ω–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- 10. –°–æ–∑–¥–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç—á–µ—Ç–∞

–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Å—Ç–∞–≤—à–µ–π—Å—è —á–∞—Å—Ç–∏ –ì–ª–∞–≤—ã 1?