## Gemini CLI: Продвинутые техники и автоматизация сценариев (Часть 2)

В первой части мы рассмотрели основы: установку, аутентификацию и выполнение одиночных команд. Теперь перейдем на следующий уровень. В этой части мы научим Gemini CLI выполнять сложные, многошаговые сценарии, которые можно сохранять, переиспользовать и делиться с командой. Это превратит инструмент из простого ассистента в мощный движок для автоматизации.

### Механизм выполнения сценариев

Ключевая идея — использовать `.md` файлы как "рецепты" или "сценарии" для Gemini. Внутри такого файла мы на естественном языке описываем последовательность действий, которые должен выполнить ИИ.

Для запуска сценария мы будем использовать встроенный инструмент `ReadFile`. Мы просто попросим Gemini прочитать файл с инструкциями и выполнить их.

**Основная команда для запуска любого сценария:**
```
> Прочитай и выполни инструкции из файла 'имя_сценария.md'
```

Теперь давайте рассмотрим несколько полезных сценариев.

---

### Сценарий: "Аудит Git-репозитория"

Эта задача знакома каждому разработчику: перед началом работы нужно проверить текущее состояние проекта. Создадим сценарий, который сделает это за нас.

1.  **Создайте файл `git-health-check.md`** со следующим содержимым:

    ```markdown
    Ты — опытный Git-инженер. Твоя задача — провести полный аудит текущего репозитория.
    
    Выполни следующие шаги строго по порядку и дождись моего подтверждения для каждой команды:
    
    1.  **Проверь статус:** Покажи мне текущий статус репозитория, чтобы увидеть неотслеживаемые или измененные файлы. Предложи команду `!git status`.
    2.  **Запроси обновления:** Получи последние изменения с удаленного сервера, но не применяй их. Предложи команду `!git fetch origin`.
    3.  **Сравни ветки:** Покажи мне разницу между моей локальной веткой `main` и удаленной `origin/main`. Предложи команду `!git log main..origin/main --oneline`.
    4.  **Найди большие файлы:** Найди 5 самых больших файлов в проекте, которые не находятся в `.git`. Предложи команду `!find . -type f -not -path "./.git/*" -printf "%s %p\n" | sort -rn | head -n 5`.
    5.  **Подведи итог:** В конце кратко опиши состояние репозитория на основе полученных данных.
    ```

2.  **Запустите сценарий в Gemini CLI:**

    ```
    > Прочитай и выполни сценарий 'git-health-check.md'
    ```

**Результат:** Gemini последовательно предложит вам выполнить каждую из команд, объясняя, что она делает. В конце он предоставит сводку, основанную на результатах проверки.

---

### Сценарий: "Очистка Docker-окружения"

Docker со временем накапливает множество ненужных образов, контейнеров и сетей. Этот сценарий поможет безопасно всё почистить.

1.  **Создайте файл `docker-cleanup.md`**:

    ```markdown
    Ты — DevOps-инженер, ответственный за чистоту системы. Твоя задача — безопасно очистить Docker-окружение.
    
    Действуй по шагам:
    
    1.  **Покажи запущенные контейнеры:** Сначала выведи список всех активных контейнеров, чтобы я мог убедиться, что не остановлю что-то важное. Предложи `!docker ps`.
    2.  **Останови все контейнеры:** После моего одобрения предложи команду для остановки ВСЕХ запущенных контейнеров. Команда: `!docker stop $(docker ps -q)`.
    3.  **Глобальная очистка:** Теперь выполни полную очистку системы от "висячих" (dangling) образов, остановленных контейнеров, неиспользуемых сетей и кэша сборки. Предложи самую безопасную и эффективную команду `!docker system prune -af`.
    4.  **Отчет:** После выполнения сообщи, сколько места было освобождено, основываясь на выводе последней команды.
    ```

2.  **Запустите сценарий в Gemini CLI:**

    ```
    > Прочитай и выполни сценарий очистки Docker из файла 'docker-cleanup.md'
    ```
**Результат:** Gemini проведет вас через безопасный процесс очистки, запрашивая подтверждение на каждом критическом шаге.

---

### Сценарий: "Запуск системных приложений"

Как и было показано в примере, Gemini отлично справляется с запуском приложений. Давайте формализуем это в виде простого сценария для Windows.

1.  **Создайте файл `open-windows-tools.md`**:

    ```markdown
    Ты — системный администратор Windows. Твоя задача — открывать системные утилиты по запросу.
    
    - Если я прошу "планировщик задач", предложи запустить `!taskschd.msc`.
    - Если я прошу "редактор реестра", предупреди об опасности и предложи запустить `!regedit`.
    - Если я прошу "монитор ресурсов", предложи запустить `!resmon`.
    - Если я прошу "диспетчер задач", предложи запустить `!taskmgr`.
    - Если я прошу "командная строка", предложи запустить `!cmd`.
    - Если я прошу "проводник", предложи запустить `!explorer`.
    Аналогично для других утилит.
    ```

2.  **Запустите сценарий и дайте команду:**

    ```
    > Используй инструкции из 'open-windows-tools.md'. Открой планировщик задач.
    ```
**Результат:** Gemini поймет контекст из файла и ваш запрос, после чего предложит выполнить нужную команду.

> **Ответ Gemini:**
> ```text
> Хорошо, открываю Планировщик задач.
>
> Выполнить `!taskschd.msc`? (y/n)
> ```
После подтверждения на вашем экране откроется стандартная утилита Windows.